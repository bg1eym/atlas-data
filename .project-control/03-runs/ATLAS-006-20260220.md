# Run Journal — ATLAS-006 (PCK-ATLAS-006)

**Task:** Fix spawn node ENOENT + ATLAS_ROOT invalid (Evidence-based)

**Timestamp:** 2026-02-20

---

## 1. Provided Evidence (Before Fix)

### TG /atlas today failure

```
spawn /opt/homebrew/bin/node ENOENT
debug shows:
  node_bin: /opt/homebrew/bin/node
  pnpm_js: /opt/homebrew/lib/node_modules/pnpm/bin/pnpm.cjs
  node_probe: exists, pnpm_js_probe: exists
  atlas_root=/Users/qiangguo/Projects/atlas-radar
```

### Shell evidence

```
/opt/homebrew/bin/node exists (symlink to Cellar)
node /opt/homebrew/lib/node_modules/pnpm/bin/pnpm.cjs -v works
ls -la /Users/qiangguo/Projects/atlas-radar => No such file or directory
```

**Root cause:** ATLAS_ROOT points to non-existent path. ENOENT may also be due to launchd exec context vs interactive shell.

---

## 2. Failure Classification (Before Fix)

failure_mode: SPAWN_FAILED_ENOENT / ATLAS_ROOT_INVALID
root_cause: ATLAS_ROOT path does not exist; launchd may use different node resolution
recommended_fix: Set ATLAS_ROOT to existing atlas-radar root; use process.execPath fallback for node

---

## 3. What Changed

| File | Change |
|------|--------|
| oc-bind/atlas-adapter.ts | process.execPath in node resolution; ATLAS_ROOT_INVALID; SPAWN_FAILED_ENOENT; fs.access pnpm R_OK |
| oc-bind/index.ts | /atlas debug: process_execPath, atlas_root_has_pkg_json, atlas_root_has_script_atlas_run, node_access, pnpm_js_access, pnpm_version_probe; gateway_node_exec in error |
| tools/atlas-root-discovery.sh | New: discover atlas-radar root by package.json + atlas:run |
| tools/atlas-acceptance-ATLAS-005.sh | New: deterministic acceptance with classification JSON |
| RG-ATLAS-005-* | New: no-radar, atlas-root-validated, node-execpath-fallback, spawn-classification |

---

## 4. Gate Raw Outputs

### Preflight

```
=== Preflight PASS ===
Latest ledger: PCK-CORE-ACTF-001
```

### Regress

```
RG-ATLAS-005-no-radar-strings PASS
RG-ATLAS-005-atlas-root-validated PASS
RG-ATLAS-005-node-execpath-fallback PASS
RG-ATLAS-005-spawn-classification PASS
...
```

### Convergence

```
=== Convergence PASS (contract unchanged) ===
```

---

## 5. Post-Fix Validation

- ATLAS_ROOT invalid → returns ATLAS_ROOT_INVALID (not raw ENOENT)
- /atlas debug prints process_execPath, atlas_root_value, atlas_root_exists, node_access, pnpm_version_probe
- tools/atlas-acceptance-ATLAS-005.sh exits 0 when ATLAS_ROOT valid; exits non-zero with classification when invalid

---

## Failure Classification

failure_mode: OK
root_cause: 
recommended_fix:
