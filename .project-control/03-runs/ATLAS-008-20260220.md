# Run Journal — ATLAS-008 (PCK-ATLAS-008)

**Task:** Fix Atlas Pipeline (Real Iteration) — ATLAS_ROOT discovery, exit 42 classification, BLOCKED → runnable

**Timestamp:** 2026-02-20

---

## 1. Hard Evidence (Section 1 — must be copied)

### A) Human shell test

Command:
```
cd $ATLAS_ROOT
pnpm run atlas:run
```

Observed result:
```
ERR_PNPM_NO_IMPORTER_MANIFEST_FOUND
No package.json (or package.yaml, or package.json5) was found in "/Users/qiangguo"
```

Interpretation: ATLAS_ROOT in the shell environment was empty/incorrect and defaulted to /Users/qiangguo. The system must prevent this class of misconfig with deterministic checks and discovery.

### B) Telegram observed behavior (latest)

- /atlas debug shows: node_bin=/opt/homebrew/bin/node, pnpm_js=/opt/homebrew/lib/node_modules/pnpm/bin/pnpm.cjs, both "exists"
- /atlas today fails with: exit 42 (BLOCKED) OR structured failure, NOT ENOENT

### C) Human-simulation script result (latest)

- telegram_debug_ok=true
- telegram_today_ok=false
- atlas_pipeline_ok=false
- convergence_status=partial
- reason: exit 42 (BLOCKED)

---

## 2. Failure Classification

failure_mode: ATLAS_PIPELINE_BLOCKED / ATLAS_ROOT_INVALID
root_cause: (1) ATLAS_ROOT misconfigured or empty; (2) pdf_sources_extract exits 42 when input pack missing and PDF_EXTRACT_ALLOW_FALLBACK not set
recommended_fix: ATLAS_ROOT discovery + validation; PDF_EXTRACT_ALLOW_FALLBACK=1 in spawn env; classify exit 42 as ATLAS_PIPELINE_BLOCKED with evidence

---

## 3. What Changed

| File | Change |
|------|--------|
| tools/atlas-root-discovery.sh | Rewrite: output JSON (candidates[], selected_root, why_selected); search $HOME/Projects, git repos |
| oc-bind/atlas-adapter.ts | scripts.atlas:run check; discovery fallback when ATLAS_ROOT invalid; PDF_EXTRACT_ALLOW_FALLBACK=1; exit 42 → ATLAS_PIPELINE_BLOCKED with evidence; ATLAS_EMPTY → ATLAS_DEGRADED (still return dashboard URL) |
| .project-control/00-ledger/PCK-ATLAS-008/ | New ledger |
| RG-ATLAS-008-* | New regressions |
| CT-ATLAS-008-run-today-local.sh | New critical test |
| tools/atlas-acceptance-ATLAS-008.sh | New acceptance script |

---

## 4. Gate Raw Outputs

(To be filled after running preflight → regress → convergence → critical-tests)

---

## 5. Human-simulation Outputs

(To be filled after running tools/atlas-007-human-simulation.sh and tools/atlas-acceptance-ATLAS-008.sh)
