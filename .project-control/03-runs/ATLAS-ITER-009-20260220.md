# Run Journal — ATLAS-ITER-009 (PCK-ATLAS-ITER-009)

**Task:** Fix "wrong repo dir + wrong ATLAS_ROOT" recurrence

**Timestamp:** 2026-02-20

---

## 1. Hard Evidence

### tools/_out/atlas-env-audit.json

```json
{
  "openclaw_plugin_installPath": "",
  "gateway_env": {
    "ATLAS_ROOT": "/Users/qiangguo/Projects/atlas-radar",
    "ATLAS_DASHBOARD_URL_BASE": "https://your-domain/atlas/{{run_id}}/",
    "ATLAS_COVER_URL_BASE": "https://your-domain/atlas/{{run_id}}/cover.png"
  },
  "atlas_root_validation": {
    "path_exists": false,
    "has_package_json": false,
    "has_script_atlas_run": false
  },
  "discovery": {
    "candidates": [
      "/Users/qiangguo/atlas-radar"
    ],
    "recommended_root": "/Users/qiangguo/atlas-radar"
  },
  "conclusion": {
    "root_cause": "ATLAS_ROOT_INVALID",
    "next_fix": "/usr/libexec/PlistBuddy -c \"Set :ATLAS_ROOT /Users/qiangguo/atlas-radar\" /Users/qiangguo/Library/LaunchAgents/ai.openclaw.gateway.plist"
  },
  "plist_path": "/Users/qiangguo/Library/LaunchAgents/ai.openclaw.gateway.plist"
}
```

---

## 2. Failure Classification

failure_mode: ATLAS_ROOT_INVALID
root_cause: launchd env ATLAS_ROOT points to /Users/qiangguo/Projects/atlas-radar which does not exist
recommended_fix: Run PlistBuddy to set ATLAS_ROOT to /Users/qiangguo/atlas-radar (or run tools/atlas-env-audit.sh for next_fix)

---

## 3. What Changed

| File | Change |
|------|--------|
| tools/atlas-env-audit.sh | New: audit gateway env, validate ATLAS_ROOT, discovery, conclusion.root_cause, conclusion.next_fix |
| .project-control/07-critical-tests/CT-ATLAS-ENV-001.sh | New: runs atlas-env-audit, fails unless root_cause=OK |
| .project-control/02-regressions/RG-ATLAS-ENV-001.sh | New: static checks for CT and atlas-env-audit |
| critical-tests.sh | Add CT-ATLAS-ENV-001 |
| test-matrix.json | Add CT-ATLAS-ENV-001 |
| oc-bind/index.ts | Add gateway_node_exec, hint "Run: bash tools/atlas-env-audit.sh" when atlas_root_exists=false |
| oc-bind/atlas-debug-simulate.ts | Same |
| .project-control/00-ledger/PCK-ATLAS-ITER-009/ | New ledger |

---

## 4. Gate Raw Outputs

(To be filled after running preflight → regress → convergence → critical-tests)

---

## 5. Activation Audit Evidence

Gateway runtime env (from launchctl print): ATLAS_ROOT=/Users/qiangguo/Projects/atlas-radar (path does not exist).
Discovery recommended_root: /Users/qiangguo/atlas-radar.
next_fix: /usr/libexec/PlistBuddy -c "Set :ATLAS_ROOT /Users/qiangguo/atlas-radar" /Users/qiangguo/Library/LaunchAgents/ai.openclaw.gateway.plist
